name: "Headless YouTube Playback (30s Test)"

on:
  workflow_dispatch:

jobs:
  youtube-play:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repo
      uses: actions/checkout@v3

    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: 20

    - name: Install Playwright + Chromium
      run: |
        npm init -y
        npm install playwright
        npx playwright install --with-deps chromium

    - name: Headless YouTube Playback (30s)
      run: |
        cat <<'EOF' > play.js
        const { chromium } = require('playwright');

        (async () => {
          console.log("üé¨ Launching headless Chrome...");
          const browser = await chromium.launch({ headless: true });
          const context = await browser.newContext();
          const page = await context.newPage();

          const url = "https://youtu.be/FNRsrDSPJnk?si=GV9EWtfCEJePhAML";
          console.log(`üåê Opening YouTube video: ${url}`);
          await page.goto(url, { waitUntil: "domcontentloaded" });

          console.log("‚ñ∂Ô∏è Attempting to play video...");
          await page.waitForSelector('video', { timeout: 15000 });
          await page.evaluate(() => {
            const video = document.querySelector('video');
            if (video) {
              video.muted = true;
              video.play();
              console.log("‚úÖ Playback started");
            } else {
              console.log("‚ùå No video element found");
            }
          });

          console.log("‚è≥ Playing for 30 seconds...");
          await page.waitForTimeout(30000);

          console.log("üõë Playback complete. Closing browser...");
          await browser.close();
          console.log("‚úÖ Job finished successfully.");
        })();
        EOF

        node play.js
