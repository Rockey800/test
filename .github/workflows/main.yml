name: Setup yt-dlp on Ubuntu & Extract Streams

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:  # Allows manual trigger

jobs:
  extract-stream:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repo
      uses: actions/checkout@v4

    - name: Update system & install dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y python3 python3-pip ffmpeg

    - name: Install yt-dlp
      run: |
        python3 -m pip install --user yt-dlp
        echo "$HOME/.local/bin" >> $GITHUB_PATH  # Add to PATH

    - name: Extract stream sources
      run: |
        # Replace this URL with your target (e.g., https://streamcenter.pro/embed/ch2.php)
        # This gets URLs without downloading
        yt-dlp -g --no-download "https://streamcenter.pro/embed/ch2.php"
        
        # Or list formats to see m3u8 options
        yt-dlp -F "https://streamcenter.pro/embed/ch2.php"
        
        # To download a specific format (uncomment if needed)
        # yt-dlp -f "best[protocol=m3u8_native]" -o "%(title)s.%(ext)s" "https://streamcenter.pro/embed/ch2.php"

    - name: Upload logs as artifact (for review)
      uses: actions/upload-artifact@v4
      with:
        name: stream-extraction-logs
        path: |
          *.log
          yt-dlp-output.txt  # Redirect output if needed: yt-dlp ... > yt-dlp-output.txt