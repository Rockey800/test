name: Stream PHP Page to Telegram

on:
  workflow_dispatch:

jobs:
  stream:
    runs-on: ubuntu-latest
    timeout-minutes: 180

    steps:
    - name: 1. Install Dependencies
      run: |
        sudo apt-get update && sudo apt-get install -y --no-install-recommends ffmpeg xvfb wget
        wget https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb
        sudo apt-get install -y ./google-chrome-stable_current_amd64.deb || true
        rm google-chrome-stable_current_amd64.deb

    - name: 2. Start Streaming
      env:
        # Use a single secret containing the full RTMP URL
        TELEGRAM_RTMP_URL: ${{ secrets.TELEGRAM_RTMP_URL }}
      run: |
        echo "‚úÖ Starting virtual display..."
        Xvfb :99 -screen 0 1280x720x24 &
        echo "‚úÖ Launching Chrome..."
        google-chrome --no-sandbox --disable-gpu --disable-dev-shm-usage --disable-dbus --window-size=1280,720 "https://www.touristy.top/frame/11.php" &
        echo "‚è≥ Waiting 8 seconds..."
        sleep 8
        echo "üöÄ Starting FFmpeg stream..."
        ffmpeg -nostdin -f x11grab -r 30 -s 1280x720 -i :99 -c:v libx264 -preset ultrafast -pix_fmt yuv420p -c:a aac -b:a 128k -ar 44100 -f flv "$TELEGRAM_RTMP_URL"
